var ZY=ZY||{};ZY.controllerManager=function(){function e(e,t){return e==ZY.config.categoryIds.sectionOneId?t>3&&(t=3):t>4&&(t=4),t}var t="",a=$("#zy_top_post").height(),o=$("#zy_section_one_bg .zy_theme_bg_content"),n=$("#zy_section_two_bg .zy_theme_bg_content"),i=$("#zy_section_three_bg .zy_theme_bg_content"),s=$("#zy_section_four_bg .zy_theme_bg_content"),d=$("#zy_nav"),c=$("#zy_section_one").offset().top-80,r=$("#zy_section_two").offset().top-80,g=$("#zy_section_three").offset().top-80,l=$("#zy_section_four").offset().top-80,_=$(".zy_footer").offset().top-80;return{judgeShowOrNot:function(e,t){0==t.parents(e).length&&ZY.uiManager.hideMusicPlayer()},splitPostDate:function(e){if("string"==typeof e){var t=e.split("-"),a=[];return a[0]=t[2]+"/"+t[1],a[1]=t[0],a}return[]},transformDatas:function(e){var t=this,a=[];return $.each(e,function(e,o){a=t.splitPostDate(o.post_date),o.post_month=a[0],o.post_year=a[1]}),e},setLoadLimit:function(t){var a=parseInt($("body").width()/t.width);return a=e(t.categoryId,a),t.targetContain.find(".zy_post_list_container").width(a*t.width),t.targetContain.find(".zy_page_next").addClass("zy_disable"),ZY.uiManager.showLoadingSpinner($(t.targetContain)),t.isFirst?t.categoryId==ZY.config.categoryIds.sectionThreeId?$("body").width()>=2*ZY.config.articleWidths.sectionThreeWidth&&(a=2*parseInt(($("body").width()-2*ZY.config.articleWidths.sectionThreeWidth)/t.width)+2*a*2+1):a=t.categoryId==ZY.config.categoryIds.sectionOneId?3*a*2:3*a:a=t.categoryId==ZY.config.categoryIds.sectionOneId||t.categoryId==ZY.config.categoryIds.sectionThreeId?2*a*2:2*a,a},doResponse:function(e){var t=e.posts.length,a=e.targetContain.find(".zy_page_next");t<=e.limit&&(0!=t&&this.handlerPosts(e.categoryId,e.posts,t,e.isFirst),a.removeClass("zy_disable"),e.categoryId==ZY.config.categoryIds.sectionThreeId?e.isFirst&&t<=(e.limit+1)/3-1&&a.addClass("zy_disable"):e.isFirst&&t<=e.limit/3&&a.addClass("zy_disable"),t<e.limit&&a.addClass("zy_no_more"))},setBackGround:function(e,t,a){e&&t.post_id!=ZY.dataManager.topPostId&&(a==ZY.config.categoryIds.sectionTwoId?(ZY.uiManager.updateSectionBg(t,$("#zy_section_two_theme")),n=$("#zy_section_two_bg .zy_theme_bg_content")):a==ZY.config.categoryIds.sectionOneId?(ZY.uiManager.updateSectionBg(t,$("#zy_section_one_theme")),o=$("#zy_section_one_bg .zy_theme_bg_content")):a==ZY.config.categoryIds.sectionFourId?(ZY.uiManager.updateSectionBg(t,$("#zy_section_four_theme")),s=$("#zy_section_four_bg .zy_theme_bg_content")):a==ZY.config.categoryIds.sectionThreeId&&(ZY.uiManager.updateSectionBg(t,$("#zy_section_three_theme")),i=$("#zy_section_three_bg .zy_theme_bg_content")))},handlerPosts:function(e,t,a,o){e==ZY.config.categoryIds.sectionTwoId?(ZY.dataManager.lastSectionTwoDate=t[a-1].post_full_date,ZY.uiManager.showSectionTwoPosts(t)):e==ZY.config.categoryIds.sectionOneId?(ZY.dataManager.lastSectionOneDate=t[a-1].post_full_date,ZY.uiManager.showSectionOnePosts(this.handlerSectionOnePosts(t,a))):e==ZY.config.categoryIds.sectionFourId?(ZY.dataManager.lastSectionFourDate=t[a-1].post_full_date,ZY.uiManager.showSectionFourPosts(t)):e==ZY.config.categoryIds.sectionThreeId&&(ZY.dataManager.lastSectionThreeDate=t[a-1].post_full_date,ZY.uiManager.showSectionThreePosts(this.handlerSectionThreePosts(t,a,o),o))},handlerSectionOnePosts:function(e,t){for(var a=[],o=0;t>o;o++){var n={};n.top=e[o];var i=++o;n.bottom=e[i],a.push(n)}return a},handlerSectionThreePosts:function(e,t,a){for(var o=[],n=0;t>n;n++){var i={};if(0==n&&a)i=e[n];else{i.top=e[n];var s=++n;i.bottom=e[s]}o.push(i)}return o},addHoverEvent:function(e){var t=e.find(".zy_page_next"),a=e.find(".zy_page_prev");e.hover(function(){a.css("opacity",1),t.css("opacity",1)},function(){a.css("opacity",0),t.css("opacity",0)})},nextPage:function(t,a,o,n){var i=parseInt($("body").width()/a);i=e(o,i);var s=t.find("a.zy_page_next"),d=t.find("a.zy_page_prev"),c=t.find(".zy_post_list_container"),r=t.find(".zy_post_list_container ul");c.width(i*a),s.hasClass("zy_no_more")?r.animate({left:parseInt(r.css("left"))-i*a},500,function(){d.removeClass("zy_disable"),o==ZY.config.categoryIds.sectionThreeId?parseInt(r.css("left"))<=-(r.find("li").length-i+1)*a&&s.addClass("zy_disable"):parseInt(r.css("left"))<=-(r.find("li").length-i)*a&&s.addClass("zy_disable")}):(ZY.dataManager.getCategoryPosts({targetContain:t,width:a,categoryId:o,lastDate:n,isFirst:!1}),r.animate({left:parseInt(r.css("left"))-i*a},500,function(){d.removeClass("zy_disable")}))},prevPage:function(t,a,o){var n=parseInt($("body").width()/a);n=e(o,n);var i=t.find("a.zy_page_next"),s=t.find("a.zy_page_prev"),d=t.find(".zy_post_list_container"),c=t.find(".zy_post_list_container ul");if(d.width(n*a),parseInt(c.css("left"))+n*a>=0)c.animate({left:0},500,function(){parseInt(c.css("left"))>-(c.find("li").length-n)*a&&i.removeClass("zy_disable"),s.addClass("zy_disable")});else{if(o==ZY.config.categoryIds.sectionThreeId&&parseInt(c.css("left"))+n*a>-400)return void c.animate({left:-400},500,function(){i.removeClass("zy_disable")});c.animate({left:parseInt(c.css("left"))+n*a},500,function(){i.removeClass("zy_disable")})}},bindHScroll:function(e){var t=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",a=function(t){var a=0;t=window.event||t,a=t.wheelDelta<0||t.detail>0?e.scrollLeft+500:e.scrollLeft-500,TweenLite.to(e,.5,{scrollTo:{x:a}}),t.preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!1)};e.addEventListener(t,a)},setWheelScrollSpeed:function(){var e=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t=function(e){var t=$(window).scrollTop();e=window.event||e,$(window).scrollTop(e.wheelDelta<0||e.detail>0?t+100:t-100),e.preventDefault?e.preventDefault():e.returnValue=!1};window.addEventListener(e,t)},scrollingHandler:function(){var e=window.pageYOffset,f=$(window).height(),y=$(window).width();e>=a?d.hasClass("zy_nav_active")||d.addClass("zy_nav_active"):d.hasClass("zy_nav_active")&&d.removeClass("zy_nav_active"),$("#zy_nav ul li a").removeClass("active"),c>=e||(r>=e?$("#zy_nav ul li:nth-child(1) a").addClass("active"):g>=e?$("#zy_nav ul li:nth-child(2) a").addClass("active"):l>=e?$("#zy_nav ul li:nth-child(4) a").addClass("active"):_>=e&&$("#zy_nav ul li:nth-child(5) a").addClass("active")),e>c-f&&c+720>=e?(ZY.config.deviceCode.iOS||(o.addClass("zy_bg_fixed"),t="rect(0px "+y+"px "+(800-(e-c)+100)+"px 0px)",o.css("clip",t)),ZY.dataManager.sectionOneLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.sectionOneWidth,categoryId:ZY.config.categoryIds.sectionOneId,isFirst:!0,lastDate:ZY.dataManager.lastSectionOneDate,targetContain:$("#zy_section_one_contain")}),ZY.dataManager.sectionOneLoaded=!0)):ZY.config.deviceCode.iOS||(o.removeClass("zy_bg_fixed"),o.css("clip","")),e>r-f&&r+720>=e?(ZY.config.deviceCode.iOS||(n.addClass("zy_bg_fixed"),t="rect(0px "+y+"px "+(800-(e-r)+100)+"px 0px)",n.css("clip",t)),ZY.dataManager.sectionTwoLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.sectionTwoWidth,categoryId:ZY.config.categoryIds.sectionTwoId,isFirst:!0,lastDate:ZY.dataManager.lastSectionTwoDate,targetContain:$("#zy_section_two_contain")}),ZY.dataManager.sectionTwoLoaded=!0)):ZY.config.deviceCode.iOS||(n.removeClass("zy_bg_fixed"),n.css("clip","")),e>g-f&&g+720>=e?(ZY.config.deviceCode.iOS||(i.addClass("zy_bg_fixed"),t="rect(0px "+y+"px "+(840-(e-g)+100)+"px 0px)",i.css("clip",t)),ZY.dataManager.sectionThreeLoaded||(ZY.dataManager.getCategoryPosts({targetContain:$("#zy_section_three_contain"),lastDate:ZY.dataManager.lastSectionThreeDate,categoryId:ZY.config.categoryIds.sectionThreeId,width:ZY.config.articleWidths.sectionThreeWidth,isFirst:!0}),ZY.dataManager.sectionThreeLoaded=!0)):ZY.config.deviceCode.iOS||(i.removeClass("zy_bg_fixed"),i.css("clip","")),e>l-f&&l+720>=e?(ZY.config.deviceCode.iOS||(s.addClass("zy_bg_fixed"),t="rect(0px "+y+"px "+(840-(e-l)+100)+"px 0px)",s.css("clip",t)),ZY.dataManager.sectionFourLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.sectionFourWidth,categoryId:ZY.config.categoryIds.sectionFourId,isFirst:!0,lastDate:ZY.dataManager.lastSectionFourDate,targetContain:$("#zy_section_four_contain")}),ZY.dataManager.sectionFourLoaded=!0)):ZY.config.deviceCode.iOS||(s.removeClass("zy_bg_fixed"),s.css("clip",""))},doResizeOfCategory:function(t,a,o,n){var i=parseInt($("body").width()/o);i=e(a,i);var s=t.find("a.zy_page_next"),d=t.find("ul"),c=t.find(".zy_post_list_container");c.width(i*o),parseInt(d.css("left"))>-(d.find("li").length-i)*o&&n?s.removeClass("zy_disable"):n&&s.addClass("zy_disable")},windowResizeHandler:function(){var e=this;ZY.dataManager.resizeTimer&&clearTimeout(ZY.dataManager.resizeTimer),ZY.dataManager.resizeTimer=setTimeout(function(){e.doResizeOfCategory($("#zy_section_two_contain"),ZY.config.categoryIds.sectionTwoId,ZY.config.articleWidths.sectionTwoWidth,ZY.dataManager.sectionTwoLoaded),e.doResizeOfCategory($("#zy_section_one_contain"),ZY.config.categoryIds.sectionOneId,ZY.config.articleWidths.sectionOneWidth,ZY.dataManager.sectionOneLoaded),e.doResizeOfCategory($("#zy_section_four_contain"),ZY.config.categoryIds.sectionFourId,ZY.config.articleWidths.sectionFourWidth,ZY.dataManager.sectionFourLoaded),e.doResizeOfCategory($("#zy_section_three_contain"),ZY.config.categoryIds.sectionThreeId,ZY.config.articleWidths.sectionThreeWidth,ZY.dataManager.sectionThreeLoaded)},200)}}}();