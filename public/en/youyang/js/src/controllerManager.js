var ZY=ZY||{};ZY.controllerManager=function(){function t(t,a){return t==ZY.config.categoryIds.landscapeId||t==ZY.config.categoryIds.artifactId?a>3&&(a=3):a>4&&(a=4),a}var a="",e=0,o=-100,n=-200,i=-180,s=-600,d=-380,c=150,r=-60,l=-200,g=$("#zy_landscape_bg .zy_theme_bg_content"),_=$("#zy_people_bg .zy_theme_bg_content"),f=$("#zy_artifact_bg .zy_theme_bg_content"),p=$("#zy_community_bg .zy_theme_bg_content"),y=$(".zy_featured").offset().top,u=$("#zy_landscape").offset().top,m=$("#zy_people").offset().top,z=$("#zy_artifact").offset().top,h=$("#zy_community").offset().top,Y=$(".zy_footer").offset().top,Z=$("#zy_featured_left"),v=$("#zy_featured_right"),b=$("#zy_landscape_left"),C=$("#zy_landscape_right"),I=$("#zy_people_left"),w=$("#zy_people_top"),M=$("#zy_people_right"),x=$("#zy_artifact_left"),D=$("#zy_artifact_bottom"),L=$("#zy_community_bottom");return{judgeShowOrNot:function(t,a){0==a.parents(t).length&&ZY.uiManager.hideMusicPlayer()},splitPostDate:function(t){if("string"==typeof t){var a=t.split("-"),e=[];return e[0]=a[2]+"/"+a[1],e[1]=a[0],e}return[]},transformDatas:function(t){var a=this,e=[];return $.each(t,function(t,o){e=a.splitPostDate(o.post_date),o.post_month=e[0],o.post_year=e[1]}),t},setLoadLimit:function(a){var e=parseInt($("body").width()/a.width);return e=t(a.categoryId,e),a.targetContain.find(".zy_list_container").width(e*a.width),a.targetContain.find(".zy_contain_next").addClass("zy_disable"),ZY.uiManager.showLoadingSpinner($(a.targetContain)),e=a.isFirst?3*e:2*e},doResponse:function(t){var a=t.posts.length,e=t.targetContain.find(".zy_contain_next");a<=t.limit&&(0!=a&&this.handlerPosts(t.categoryId,t.posts,a,t.isFirst),e.removeClass("zy_disable"),t.isFirst&&a<=t.limit/3&&e.addClass("zy_disable"),a<t.limit&&e.addClass("zy_no_more"))},setBackGround:function(t,a,e){t&&a.post_id!=ZY.dataManager.topPostId&&(e==ZY.config.categoryIds.peopleId?(ZY.uiManager.updateSectionBg(a,$("#zy_people_theme")),_=$("#zy_people_bg .zy_theme_bg_content")):e==ZY.config.categoryIds.landscapeId?(ZY.uiManager.updateSectionBg(a,$("#zy_landscape_theme")),g=$("#zy_landscape_bg .zy_theme_bg_content")):e==ZY.config.categoryIds.communityId?(ZY.uiManager.updateSectionBg(a,$("#zy_community_theme")),p=$("#zy_community_bg .zy_theme_bg_content")):e==ZY.config.categoryIds.artifactId&&(ZY.uiManager.updateSectionBg(a,$("#zy_artifact_theme")),f=$("#zy_artifact_bg .zy_theme_bg_content")))},handlerPosts:function(t,a,e){t==ZY.config.categoryIds.peopleId?(ZY.dataManager.lastPeopleDate=a[e-1].post_full_date,ZY.uiManager.showPeoplePosts(a)):t==ZY.config.categoryIds.landscapeId?(ZY.dataManager.lastLandscapeDate=a[e-1].post_full_date,ZY.uiManager.showLandscapePosts(a)):t==ZY.config.categoryIds.communityId?(ZY.dataManager.lastCommunityDate=a[e-1].post_full_date,ZY.uiManager.showCommunityPosts(a)):t==ZY.config.categoryIds.artifactId&&(ZY.dataManager.lastArtifactDate=a[e-1].post_full_date,ZY.uiManager.showArtifactPosts(a))},handlerLandscapePosts:function(t,a){for(var e=[],o=0;a>o;o++){var n={};n.top=t[o];var i=++o;n.bottom=t[i],e.push(n)}return e},handlerArtifactPosts:function(t,a,e){for(var o=[],n=0;a>n;n++){var i={};if(0==n&&e)i=t[n];else{i.top=t[n];var s=++n;i.bottom=t[s]}o.push(i)}return o},addHoverEvent:function(t){var a=t.find(".zy_contain_next"),e=t.find(".zy_contain_prev");t.hover(function(){e.css("opacity",1),a.css("opacity",1)},function(){e.css("opacity",0),a.css("opacity",0)})},nextPage:function(a,e,o,n){var i=parseInt($("body").width()/e);i=t(o,i);var s=a.find("a.zy_contain_next"),d=a.find("a.zy_contain_prev"),c=a.find(".zy_list_container"),r=a.find(".zy_list_container ul");c.width(i*e),s.hasClass("zy_no_more")?r.animate({left:parseInt(r.css("left"))-i*e},500,function(){d.removeClass("zy_disable"),parseInt(r.css("left"))<=-(r.find("li").length-i)*e&&s.addClass("zy_disable")}):(ZY.dataManager.getCategoryPosts({targetContain:a,width:e,categoryId:o,lastDate:n,isFirst:!1}),r.animate({left:parseInt(r.css("left"))-i*e},500,function(){d.removeClass("zy_disable")}))},prevPage:function(a,e,o){var n=parseInt($("body").width()/e);n=t(o,n);var i=a.find("a.zy_contain_next"),s=a.find("a.zy_contain_prev"),d=a.find(".zy_list_container"),c=a.find(".zy_list_container ul");d.width(n*e),parseInt(c.css("left"))+n*e>=0?c.animate({left:0},500,function(){parseInt(c.css("left"))>-(c.find("li").length-n)*e&&i.removeClass("zy_disable"),s.addClass("zy_disable")}):c.animate({left:parseInt(c.css("left"))+n*e},500,function(){i.removeClass("zy_disable")})},bindHScroll:function(t){var a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e=function(a){var e=0;a=window.event||a,e=a.wheelDelta<0||a.detail>0?t.scrollLeft+500:t.scrollLeft-500,TweenLite.to(t,.5,{scrollTo:{x:e}}),a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.returnValue=!1,a.cancelBubble=!1)};t.addEventListener(a,e)},setWheelScrollSpeed:function(){var t=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",a=function(t){var a=$(window).scrollTop();t=window.event||t,$(window).scrollTop(t.wheelDelta<0||t.detail>0?a+100:a-100),t.preventDefault?t.preventDefault():t.returnValue=!1};window.addEventListener(t,a)},scrollingHandler:function(){var t=window.pageYOffset,P=$(window).height(),S=$(window).width();$("#zy_nav ul li a").removeClass("active"),u>=t||(m>=t?$("#zy_nav ul li:nth-child(1) a").addClass("active"):z>=t?$("#zy_nav ul li:nth-child(2) a").addClass("active"):h>=t?$("#zy_nav ul li:nth-child(3) a").addClass("active"):Y>=t&&$("#zy_nav ul li:nth-child(4) a").addClass("active")),t>u-P&&u+720>=t?(ZY.config.deviceCode.iOS||(g.addClass("zy_bg_fixed"),a="rect(0px "+S+"px "+(720-(t-u)+100)+"px 0px)",g.css("clip",a)),ZY.dataManager.landscapeLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.landscapeWidth,categoryId:ZY.config.categoryIds.landscapeId,isFirst:!0,lastDate:ZY.dataManager.lastLandscapeDate,targetContain:$("#zy_landscape_contain")}),ZY.dataManager.landscapeLoaded=!0)):ZY.config.deviceCode.iOS||(g.removeClass("zy_bg_fixed"),g.css("clip","")),t>m-P&&m+720>=t?(ZY.config.deviceCode.iOS||(_.addClass("zy_bg_fixed"),a="rect(0px "+S+"px "+(720-(t-m)+100)+"px 0px)",_.css("clip",a)),ZY.dataManager.peopleLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.peopleWidth,categoryId:ZY.config.categoryIds.peopleId,isFirst:!0,lastDate:ZY.dataManager.lastPeopleDate,targetContain:$("#zy_people_contain")}),ZY.dataManager.peopleLoaded=!0)):ZY.config.deviceCode.iOS||(_.removeClass("zy_bg_fixed"),_.css("clip","")),t>z-P&&z+720>=t?(ZY.config.deviceCode.iOS||(f.addClass("zy_bg_fixed"),a="rect(0px "+S+"px "+(720-(t-z)+100)+"px 0px)",f.css("clip",a)),ZY.dataManager.artifactLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.artifactWidth,categoryId:ZY.config.categoryIds.artifactId,isFirst:!0,lastDate:ZY.dataManager.lastArtifactDate,targetContain:$("#zy_artifact_contain")}),ZY.dataManager.artifactLoaded=!0)):ZY.config.deviceCode.iOS||(f.removeClass("zy_bg_fixed"),f.css("clip","")),t>h-P&&h+720>=t?(ZY.config.deviceCode.iOS||(p.addClass("zy_bg_fixed"),a="rect(0px "+S+"px "+(720-(t-h)+100)+"px 0px)",p.css("clip",a)),ZY.dataManager.communityLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.communityWidth,categoryId:ZY.config.categoryIds.communityId,isFirst:!0,lastDate:ZY.dataManager.lastCommunityDate,targetContain:$("#zy_community_contain")}),ZY.dataManager.communityLoaded=!0)):ZY.config.deviceCode.iOS||(p.removeClass("zy_bg_fixed"),p.css("clip","")),ZY.config.deviceCode.iOS||(t>e?(t>=y-300&&0>=o+9&&(Z.css("bottom",o+9),v.css("bottom",o+9),o+=9),t>u+500&&0>=n+18&&(b.css("bottom",n+18),C.css("bottom",n+18),n+=18),t>m&&(i-10>=-280&&(w.css("top",i-10),i-=10),-400>=s+15&&(I.css("bottom",s+15),s+=15),t>m+800&&-280>=d+15&&(M.css("bottom",d+15),d+=15)),t>z+300&&(c-10>=50&&(x.css("top",c-10),c-=10),t>z+800&&40>=r+10&&(D.css("bottom",r+10),r+=10)),t>h+800&&0>=l+15&&(L.css("bottom",l+15),l+=15)):(u>t&&o-9>=-100&&(Z.css("bottom",o-9),v.css("bottom",o-9),o-=9),m>t&&n-18>=-200&&(b.css("bottom",n-18),C.css("bottom",n-18),n-=18),m+1600>t&&(m+1200>t&&-180>=i+10&&(w.css("top",i+10),i+=10),m+1800>t&&(s-15>=-600&&(I.css("bottom",s-15),s-=15),d-15>=-380&&(M.css("bottom",d-15),d-=15))),z+1600>t&&(z+1400>t&&150>=c+10&&(x.css("top",c+10),c+=10),r-10>=-60&&(D.css("bottom",r-10),r-=10)),Y>t&&l-15>=-200&&(L.css("bottom",l-15),l-=15))),e=t},doResizeOfCategory:function(a,e,o,n){var i=parseInt($("body").width()/o);i=t(e,i);var s=a.find("a.zy_contain_next"),d=a.find("ul"),c=a.find(".zy_list_container");c.width(i*o),parseInt(d.css("left"))>-(d.find("li").length-i)*o&&n?s.removeClass("zy_disable"):n&&s.addClass("zy_disable")},windowResizeHandler:function(){var t=this;ZY.dataManager.resizeTimer&&clearTimeout(ZY.dataManager.resizeTimer),ZY.dataManager.resizeTimer=setTimeout(function(){t.doResizeOfCategory($("#zy_people_contain"),ZY.config.categoryIds.peopleId,ZY.config.articleWidths.peopleWidth,ZY.dataManager.peopleLoaded),t.doResizeOfCategory($("#zy_landscape_contain"),ZY.config.categoryIds.landscapeId,ZY.config.articleWidths.landscapeWidth,ZY.dataManager.landscapeLoaded),t.doResizeOfCategory($("#zy_community_contain"),ZY.config.categoryIds.communityId,ZY.config.articleWidths.communityWidth,ZY.dataManager.communityLoaded),t.doResizeOfCategory($("#zy_artifact_contain"),ZY.config.categoryIds.artifactId,ZY.config.articleWidths.artifactWidth,ZY.dataManager.artifactLoaded)},200)}}}();