var ZY=ZY||{};ZY.controllerManager=function(){function a(a,t){return a==ZY.config.categoryIds.landscapeId?t>3&&(t=3):t>4&&(t=4),t}var t=$("#zy_top_post").height(),e=$("#zy_landscape_bg .zy_theme_bg_content"),i=$("#zy_people_bg .zy_theme_bg_content"),n=$("#zy_artifact_bg .zy_theme_bg_content"),o=$("#zy_community_bg .zy_theme_bg_content"),s=$("#zy_top_post"),d=$("#zy_nav"),c=$("#zy_landscape").offset().top-80,r=$("#zy_people").offset().top-80,l=$("#zy_artifact").offset().top-80,g=$("#zy_community").offset().top-80,f=$(".zy_footer").offset().top-80;return{judgeShowOrNot:function(a,t){0==t.parents(a).length&&ZY.uiManager.hideMusicPlayer()},splitPostDate:function(a){if("string"==typeof a){var t=a.split("-"),e=[];return e[0]=t[2]+"/"+t[1],e[1]=t[0],e}return[]},transformDatas:function(a){var t=this,e=[];return $.each(a,function(a,i){e=t.splitPostDate(i.post_date),i.post_month=e[0],i.post_year=e[1]}),a},setLoadLimit:function(t){var e=parseInt($("body").width()/t.width);return e=a(t.categoryId,e),t.targetContain.find(".zy_list_container").width(e*t.width),t.targetContain.find(".zy_contain_next").addClass("zy_disable"),ZY.uiManager.showLoadingSpinner($(t.targetContain)),t.isFirst?t.categoryId==ZY.config.categoryIds.artifactId?$("body").width()>=2*ZY.config.articleWidths.artifactWidth&&(e=2*parseInt(($("body").width()-2*ZY.config.articleWidths.artifactWidth)/t.width)+2*e*2+1):e=t.categoryId==ZY.config.categoryIds.landscapeId?3*e*2:3*e:e=t.categoryId==ZY.config.categoryIds.landscapeId||t.categoryId==ZY.config.categoryIds.artifactId?2*e*2:2*e,e},doResponse:function(a){var t=a.posts.length,e=a.targetContain.find(".zy_contain_next");t<=a.limit&&(0!=t&&this.handlerPosts(a.categoryId,a.posts,t,a.isFirst),e.removeClass("zy_disable"),a.categoryId==ZY.config.categoryIds.artifactId?a.isFirst&&t<=(a.limit+1)/3-1&&e.addClass("zy_disable"):a.isFirst&&t<=a.limit/3&&e.addClass("zy_disable"),t<a.limit&&e.addClass("zy_no_more"))},setBackGround:function(a,t,s){a&&t.post_id!=ZY.dataManager.topPostId&&(s==ZY.config.categoryIds.peopleId?(ZY.uiManager.updateSectionBg(t,$("#zy_people_theme")),i=$("#zy_people_bg .zy_theme_bg_content")):s==ZY.config.categoryIds.landscapeId?(ZY.uiManager.updateSectionBg(t,$("#zy_landscape_theme")),e=$("#zy_landscape_bg .zy_theme_bg_content")):s==ZY.config.categoryIds.communityId?(ZY.uiManager.updateSectionBg(t,$("#zy_community_theme")),o=$("#zy_community_bg .zy_theme_bg_content")):s==ZY.config.categoryIds.artifactId&&(ZY.uiManager.updateSectionBg(t,$("#zy_artifact_theme")),n=$("#zy_artifact_bg .zy_theme_bg_content")))},handlerPosts:function(a,t,e,i){a==ZY.config.categoryIds.peopleId?(ZY.dataManager.lastPeopleDate=t[e-1].post_full_date,ZY.uiManager.showPeoplePosts(t)):a==ZY.config.categoryIds.landscapeId?(ZY.dataManager.lastLandscapeDate=t[e-1].post_full_date,ZY.uiManager.showLandscapePosts(this.handlerLandscapePosts(t,e))):a==ZY.config.categoryIds.communityId?(ZY.dataManager.lastCommunityDate=t[e-1].post_full_date,ZY.uiManager.showCommunityPosts(t)):a==ZY.config.categoryIds.artifactId&&(ZY.dataManager.lastArtifactDate=t[e-1].post_full_date,ZY.uiManager.showArtifactPosts(this.handlerArtifactPosts(t,e,i),i))},handlerLandscapePosts:function(a,t){for(var e=[],i=0;t>i;i++){var n={};n.top=a[i];var o=++i;n.bottom=a[o],e.push(n)}return e},handlerArtifactPosts:function(a,t,e){for(var i=[],n=0;t>n;n++){var o={};if(0==n&&e)o=a[n];else{o.top=a[n];var s=++n;o.bottom=a[s]}i.push(o)}return i},addHoverEvent:function(a){var t=a.find(".zy_contain_next"),e=a.find(".zy_contain_prev");a.hover(function(){e.css("opacity",1),t.css("opacity",1)},function(){e.css("opacity",0),t.css("opacity",0)})},nextPage:function(t,e,i,n){var o=parseInt($("body").width()/e);o=a(i,o);var s=t.find("a.zy_contain_next"),d=t.find("a.zy_contain_prev"),c=t.find(".zy_list_container"),r=t.find(".zy_list_container ul");c.width(o*e),s.hasClass("zy_no_more")?r.animate({left:parseInt(r.css("left"))-o*e},500,function(){d.removeClass("zy_disable"),i==ZY.config.categoryIds.artifactId?parseInt(r.css("left"))<=-(r.find("li").length-o+1)*e&&s.addClass("zy_disable"):parseInt(r.css("left"))<=-(r.find("li").length-o)*e&&s.addClass("zy_disable")}):(ZY.dataManager.getCategoryPosts({targetContain:t,width:e,categoryId:i,lastDate:n,isFirst:!1}),r.animate({left:parseInt(r.css("left"))-o*e},500,function(){d.removeClass("zy_disable")}))},prevPage:function(t,e,i){var n=parseInt($("body").width()/e);n=a(i,n);var o=t.find("a.zy_contain_next"),s=t.find("a.zy_contain_prev"),d=t.find(".zy_list_container"),c=t.find(".zy_list_container ul");if(d.width(n*e),parseInt(c.css("left"))+n*e>=0)c.animate({left:0},500,function(){parseInt(c.css("left"))>-(c.find("li").length-n)*e&&o.removeClass("zy_disable"),s.addClass("zy_disable")});else{if(i==ZY.config.categoryIds.artifactId&&parseInt(c.css("left"))+n*e>-400)return void c.animate({left:-400},500,function(){o.removeClass("zy_disable")});c.animate({left:parseInt(c.css("left"))+n*e},500,function(){o.removeClass("zy_disable")})}},bindHScroll:function(a){var t=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e=function(t){var e=0;t=window.event||t,e=t.wheelDelta<0||t.detail>0?a.scrollLeft+500:a.scrollLeft-500,TweenLite.to(a,.5,{scrollTo:{x:e}}),t.preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!1)};a.addEventListener(t,e)},setWheelScrollSpeed:function(){var a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",t=function(a){var t=$(window).scrollTop();a=window.event||a,$(window).scrollTop(a.wheelDelta<0||a.detail>0?t+100:t-100),a.preventDefault?a.preventDefault():a.returnValue=!1};window.addEventListener(a,t)},scrollingHandler:function(){{var a=window.pageYOffset,_=$(window).height();$(window).width()}a>=t?d.hasClass("zy_nav_active")||(d.addClass("zy_nav_active"),s.addClass("active_nav")):d.hasClass("zy_nav_active")&&(d.removeClass("zy_nav_active"),s.removeClass("active_nav")),$("#zy_nav ul li a").removeClass("active"),c>=a||(r>=a?$("#zy_nav ul li:nth-child(1) a").addClass("active"):l>=a?$("#zy_nav ul li:nth-child(2) a").addClass("active"):g>=a?$("#zy_nav ul li:nth-child(4) a").addClass("active"):f>=a&&$("#zy_nav ul li:nth-child(5) a").addClass("active")),a>c-_&&c+800>=a?(ZY.config.deviceCode.iOS||e.addClass("zy_bg_fixed"),ZY.dataManager.landscapeLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.landscapeWidth,categoryId:ZY.config.categoryIds.landscapeId,isFirst:!0,lastDate:ZY.dataManager.lastLandscapeDate,targetContain:$("#zy_landscape_contain")}),ZY.dataManager.landscapeLoaded=!0)):ZY.config.deviceCode.iOS||(e.removeClass("zy_bg_fixed"),e.css("clip","")),a>r-_&&r+800>=a?(ZY.config.deviceCode.iOS||i.addClass("zy_bg_fixed"),ZY.dataManager.peopleLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.peopleWidth,categoryId:ZY.config.categoryIds.peopleId,isFirst:!0,lastDate:ZY.dataManager.lastPeopleDate,targetContain:$("#zy_people_contain")}),ZY.dataManager.peopleLoaded=!0)):ZY.config.deviceCode.iOS||(i.removeClass("zy_bg_fixed"),i.css("clip","")),a>l-_&&l+800>=a?(ZY.config.deviceCode.iOS||n.addClass("zy_bg_fixed"),ZY.dataManager.artifactLoaded||(ZY.dataManager.getCategoryPosts({targetContain:$("#zy_artifact_contain"),lastDate:ZY.dataManager.lastArtifactDate,categoryId:ZY.config.categoryIds.artifactId,width:ZY.config.articleWidths.artifactWidth,isFirst:!0}),ZY.dataManager.artifactLoaded=!0)):ZY.config.deviceCode.iOS||(n.removeClass("zy_bg_fixed"),n.css("clip","")),a>g-_&&g+800>=a?(ZY.config.deviceCode.iOS||o.addClass("zy_bg_fixed"),ZY.dataManager.communityLoaded||(ZY.dataManager.getCategoryPosts({width:ZY.config.articleWidths.communityWidth,categoryId:ZY.config.categoryIds.communityId,isFirst:!0,lastDate:ZY.dataManager.lastCommunityDate,targetContain:$("#zy_community_contain")}),ZY.dataManager.communityLoaded=!0)):ZY.config.deviceCode.iOS||(o.removeClass("zy_bg_fixed"),o.css("clip",""))},doResizeOfCategory:function(t,e,i,n){var o=parseInt($("body").width()/i);o=a(e,o);var s=t.find("a.zy_contain_next"),d=t.find("ul"),c=t.find(".zy_list_container");c.width(o*i),parseInt(d.css("left"))>-(d.find("li").length-o)*i&&n?s.removeClass("zy_disable"):n&&s.addClass("zy_disable")},windowResizeHandler:function(){var a=this;ZY.dataManager.resizeTimer&&clearTimeout(ZY.dataManager.resizeTimer),ZY.dataManager.resizeTimer=setTimeout(function(){a.doResizeOfCategory($("#zy_people_contain"),ZY.config.categoryIds.peopleId,ZY.config.articleWidths.peopleWidth,ZY.dataManager.peopleLoaded),a.doResizeOfCategory($("#zy_landscape_contain"),ZY.config.categoryIds.landscapeId,ZY.config.articleWidths.landscapeWidth,ZY.dataManager.landscapeLoaded),a.doResizeOfCategory($("#zy_community_contain"),ZY.config.categoryIds.communityId,ZY.config.articleWidths.communityWidth,ZY.dataManager.communityLoaded),a.doResizeOfCategory($("#zy_artifact_contain"),ZY.config.categoryIds.artifactId,ZY.config.articleWidths.artifactWidth,ZY.dataManager.artifactLoaded)},200)}}}();